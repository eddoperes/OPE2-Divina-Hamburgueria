<html>

	<head>
		<meta charset="utf8"/>
		<script src="jquery/jquery3.6.js"></script>
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
		<script src="bootstrap/dist/js/bootstrap.js"></script>
        <link rel="stylesheet" href="css/sistema.css" >
        <script src="js/sistema.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

	<body>     

		<div class="setecincoporcento">

			<br/>
			<a href="home.html">Home</a>		
			<br/>

			<br/>
			<h1>Listar estoque</h1>
			<br/>

			<a href="estoque_entrada.html">Entrada</a>
			<br/>
			<br/>

			<div class="borderumpixelpaddingvintepixel">
				<div class="mb-3">
					<label for="quantidade" class="form-label">Quantidade abaixo de</label>
					<input id="quantidade" class="form-control" type='number' value='100' />
				</div>

				<div class="col-auto">
					<input type='button' class="btn btn-primary mb-3" value='Pesquisar' onclick="Busca()" />    
				</div>
			</div>

			<div id="table_container">
			</div>

		</div>

	</body>

	<script>
		
		$(document).ready(function() {					
			if (CheckLogin() == false)
				return;						
			LoadLists();
		});		

		var itemdoestoquelist;

		function LoadLists(){
			WebApi_GET_LIST_ItemDoEstoque
			(
				"",
				function success(data) {	
					//console.log(data);
					itemdoestoquelist = data;
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					//console.log(xhr.responseText);			
				}	
			);	
		}

		function CheckLogin(){
			var idusuario = getLoggedUserId();
			if (idusuario == -1)
			{
				var page =  window.location.pathname.split("/").pop();
				window.location.href = window.location.href.replace(page,'login.html');	
				return false;					
			}								
			else
			{
				return true;
			}
		}

		function Busca()
		{

			WebApi_GET_LIST_Estoque
			(
				'?quantidade=' + $('#quantidade').val(),
				function success(data) {			
					//console.log(data);			
					var textData = '<table class="table">';

					textData += '<tr>';

					textData += '<th>';
					textData += 'Id';
					textData += '</th>';

					textData += '<th>';
					textData += 'Item';
					textData += '</th>';

					textData += '<th class="coluna_oculta_cel">';
					textData += 'Qtde';
					textData += '</th>';
		
					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '</tr>';

					var i;	                       
					for (i=0; i < data.length; i++){
						textData += '<tr>';

						textData += '<td>';
						textData += data[i].id;
						textData += '</td>';								
						
						var k;
						for (k=0; k < itemdoestoquelist.length; k++){
							if (itemdoestoquelist[k].id ==  data[i].itemdoestoque){
								textData += '<td>';
								textData += itemdoestoquelist[k].nome +
											" " +
											itemdoestoquelist[k].marca +
											" " +
											itemdoestoquelist[k].conteudo +
											" " +
											itemdoestoquelist[k].unidade;
								textData += '</td>';
								break;
							}
						}

						textData += '<td class="coluna_oculta_cel">';
						textData += data[i].quantidade;
						textData += '</td>';

						textData += '<td>';
						textData += '<a href="estoque_editar.html?id=' + data[i].id + '">Editar</a>';
						textData += '</td>';

						textData += '<td>';
						textData += '<a href="estoque_excluir.html?id=' + data[i].id + '">Excluir</a>';
						textData += '</td>';

						textData += '</tr>';
					}	
					textData += '</table>'
					$('#table_container').html(textData);	
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					//console.log(xhr.responseText);			
				}				
			);

		}

	</script>

</html>