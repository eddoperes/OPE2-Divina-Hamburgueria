<html>

<head>
	<meta charset="utf8"/>
	<script src="jquery/jquery3.6.js"></script>
	<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
	<script src="bootstrap/dist/js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/sistema.css" >
    <script src="js/sistema.js"></script>	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

	<div class="setecincoporcento">

		<br/>
		<a href="home.html">Home</a>		
		<br/>

		<br/>
		<h1>Login</h1>
		<br/>

		<div class="mb-3">
  			<label for="email" class="form-label asterisk">Email</label>
  			<input id="email" class="form-control" type='text' value='' />
			<label class="invalid-feedback">O email precisa ser informado</label>
		</div>

		<div class="mb-3">
  			<label for="senha" class="form-label asterisk">Senha</label>
  			<input id="senha" class="form-control" type='password' value='' />
			<label class="invalid-feedback">A senha precisa ser informada</label>
		</div>

		<div>
			<div class="col-auto">
    			<input id="enviar" type="button" class="btn btn-primary mb-3 floatleft" value='Enviar' />    
			</div>

			<a href="login_esqueci.html" class="floatright" >Esqueci a senha</a>

			<div class="clearboth"></div>
		</div>

		<div id="sucesso" class="alert alert-success displaynone" role="alert" >
			Login aceito! <a href="home.html">Seguir para home page</a>
		</div>

		<div id="falha" class="alert alert-danger displaynone" role="alert" >  			
		</div>

	</div>

</body>

<script>


	$(document).ready(function() {	

		$("#email").on(" keyup focusout change ", function (){
			if ($("#email").val() == "")
				$("#email").addClass("is-invalid");
			else
				$("#email").removeClass("is-invalid");
		}); 

		$("#senha").on(" keyup focusout change ", function (){
			if ($("#senha").val() == "")
				$("#senha").addClass("is-invalid");
			else
				$("#senha").removeClass("is-invalid");
		});

		$("#enviar").on(" click ", function (){
			EnviarClick();
		});

		$(document).on(" keypress ", function (e){			
			if (e.keyCode == 13)
				EnviarClick();
		});

	});

	function ValidarLogin (){

		var result = true;

		if ($("#email").val() == ""){
			$("#email").addClass("is-invalid");
			result = false;
		} else {
			$("#email").removeClass("is-invalid");
		}

		if ($("#senha").val() == ""){
			$("#senha").addClass("is-invalid");
			result = false;
		} else {
			$("#senha").removeClass("is-invalid");
		}

		return result;

	}

	function EnviarClick()
	{

		if (ValidarLogin() == false)
			return;

		WebApi_POST_Login
		(
			{email : $('#email').val(), senha : $('#senha').val()}, 
			function success (data) {
				console.log(data);
				doLogin(data['id']);					
			}, 
			function complete(xhr, text) {
				console.log(xhr.status);
				console.log(xhr.responseText);
				if (xhr.status == 200){
					$('#falha').css('display','none');
					$('#sucesso').css('display','block');				
				}
				else{
					$('#sucesso').css('display','none');
					$('#falha').css('display','block');
					$('#falha').text("Ocorreu uma falha: " + xhr.responseText);
				}
			}     
		)

	}

</script>

</html>