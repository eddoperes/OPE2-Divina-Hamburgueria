<html>

	<head>
		<meta charset="utf8"/>
		<script src="jquery/jquery3.6.js"></script>
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
		<script src="bootstrap/dist/js/bootstrap.js"></script>
        <link rel="stylesheet" href="css/sistema.css" >
        <script src="js/sistema.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

	<body>     

		<div class="setecincoporcento">

			<br/>
			<a href="home.html">Home</a>		
			<br/>

			<br/>
			<h1>Listar fornecedores</h1>
			<br/>

			<a href="fornecedor_novo.html">Novo</a>
			<br/>
			<br/>

			<div class="borderumpixelpaddingvintepixel">
				<div class="mb-3">
					<label for="nome" class="form-label">Nome</label>
					<input id="nome" class="form-control" type='text' value='' />
				</div>

				<div class="col-auto">
						<input type='button' class="btn btn-primary mb-3" value='Pesquisar' onclick="Busca()" />    
				</div>
			</div>

			<div id="table_container">
			</div>

		</div>

	</body>

	<script>

		$(document).ready(function() {					
			if (CheckLogin() == false)
				return;							
		});		

		function CheckLogin(){
			var idcliente = getLoggedUserId();
			if (idcliente == -1)
			{
				var page =  window.location.pathname.split("/").pop();
				window.location.href = window.location.href.replace(page,'login.html');	
				return false;					
			}								
			else
			{
				return true;
			}
		}

		function Busca()
		{

			WebApi_GET_LIST_Fornecedor
			(
				'?nome=' + $('#nome').val(),
				function success(data) {			
					console.log(data);			
					var textData = '<table class="table">';

					textData += '<tr>';

					textData += '<th>';
					textData += 'Id';
					textData += '</th>';

					textData += '<th>';
					textData += 'Nome';
					textData += '</th>';

					textData += '<th>';
					textData += 'CNPJ';
					textData += '</th>';				

					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '</tr>';

					var i;	                       
					for (i=0; i < data.length; i++){
						textData += '<tr>';

						textData += '<td>';
						textData += data[i].id;
						textData += '</td>';

						textData += '<td>';
						textData += data[i].nome;
						textData += '</td>';

						textData += '<td>';
						if (data[i].cnpj == null)
							textData += '--em branco--';
						else
							textData += data[i].cnpj;
						textData += '</td>';					

						textData += '<td>';
						textData += '<a href="fornecedor_editar.html?id=' + data[i].id + '">Editar</a>';
						textData += '</td>';

						textData += '<td>';
						textData += '<a href="fornecedor_excluir.html?id=' + data[i].id + '">Excluir</a>';
						textData += '</td>';

						textData += '</tr>';
					}	
					textData += '</table>'
					$('#table_container').html(textData);	
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);			
				}				
			);

		}

	</script>

</html>