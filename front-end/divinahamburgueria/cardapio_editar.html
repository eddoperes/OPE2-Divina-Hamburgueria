<html>

	<head>
		<meta charset="utf8"/>
		<script src="jquery/jquery3.6.js"></script>
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
		<script src="bootstrap/dist/js/bootstrap.js"></script>
		<link rel="stylesheet" href="css/sistema.css" >
		<script src="js/sistema.js"></script>
	</head>

	<body>        

		<div class="setecincoporcento">

			<input type="hidden" id="idusuario" value="0">

			<br/>
			<a href="home.html">Home</a>		
			<br/>

			<br/>
			<h1 class="floatleft">Editar card치pio</h1>
			<label class="floatright widthvintecincoporcento"><label class="asterisk"></label>
				Campos obrigat칩rios
			</label>
			<br/>
			<div class="clearboth"></div>
			<br/>		

		</div>

		<div id="base_CDP" class="setecincoporcento">
		</div>

		<div id="base_ITE" class="setecincoporcento">
		</div>

		<div id="cardapio_base_ITE_LIN" class="displaynone">
		</div>

		<div id="base_ENV" class="setecincoporcento">
		</div>

	</body>

	<script>

		$(function(){
			$("#base_CDP").load("cardapio_base_CDP.html"); 						 								
			$("#cardapio_base_ITE_LIN").load("cardapio_base_ITE_LIN.html");			
			if (CheckLogin() == false)
				return;
			$("#base_ITE").load("cardapio_base_ITE.html",function (){
				LoadLists();
			});			
			$("#base_ENV").load("cardapio_base_ENV.html");
		});		

		function CheckLogin(){
			var idusuario = getLoggedUserId();
			if (idusuario == -1)
			{
				var page =  window.location.pathname.split("/").pop();
				window.location.href = window.location.href.replace(page,'login.html');	
				return false;					
			}								
			else
			{
				$('#idusuario').val(idusuario);
				return true;
			}
		}

		var itemdocardapio_list;

		function LoadLists(){

			WebApi_GET_LIST_ItemDoCardapio
			(
				'', 
				function success(data) {			
					console.log(data);
					itemdocardapio_list = data;
					LoadData();
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);			
				}   
			)

		}

		function LoadData(){

			var query = queryObj();

			WebApi_GET_Cardapio
			(
				query.id, 
				function success(data) {
					console.log(data);
					$('#id').val(data.id);
					$('#nome').val(data.nome);
					$('#descricao').val(data.descricao);
					$('#estado').val(data.estado);
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);
				}
			);

			WebApi_GET_LIST_CardapioItemDoCardapio
			(
				'?cardapio=' + query.id, 
				function success(data) {
					console.log(data);																		
					for (i=0; i < data.length; i++){
						AdicionarItem();
						$('#id' + (i + 1)).val(data[i].id);				
						$('#itemdocardapio' + (i + 1)).val(data[i].itemdocardapio);
						$('#preco' + (i + 1)).val(data[i].preco);
						$('#estado' + (i + 1)).val(data[i].estado);															
					}												
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);					
				}     
			);

		}

		function Enviar_Click()
		{

			if (ValidarCardapio() == false)
				return;
			
			WebApi_PUT_Cardapio
			(
				$('#id').val(), 
				{nome : $('#nome').val() , descricao : $('#descricao').val(), estado : $('#estado').val() }, 
				function success(data) {
					console.log(data);
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);
					if (xhr.status == 200){
						$('#falha').css('display','none');
						$('#sucesso').css('display','block');
						$('#sucesso').html("O card치pio foi editado com sucesso! <a href='cardapio_listar.html'>Seguir para a lista de card치pios</a>");
					}
					else{
						$('#sucesso').css('display','none');
						$('#falha').css('display','block');
						$('#falha').text("Ocorreu uma falha: " + xhr.responseText);
					}
				}
			);
			CrudCardapioItemDoCardapio(1);

		}

	</script>

</html>