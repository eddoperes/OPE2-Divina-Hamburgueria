<html>

	<head>
		<meta charset="utf8"/>
		<script src="jquery/jquery3.6.js"></script>
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
		<script src="bootstrap/dist/js/bootstrap.js"></script>
		<link rel="stylesheet" href="css/sistema.css" >
		<script src="js/sistema.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

	<body>        

		<div class="setecincoporcento">

			<input type="hidden" id="idusuario" value="0">

			<div id="menu">
                	</div>

			<br/>
			<h1>Excluir fornecedor</h1>
			<br/>

			<div class="alert alert-warning" role="alert">
				Atenção! Esta operação não poderá ser desfeita!
			</div>

			<input type="hidden" id="idfornecedor" value="0">

			<div class="mb-3">
				<label for="nome" class="form-label asterisk">Nome</label>                                                            
				<input id="nome" class="form-control" type='text' value="" />
				<label id="feedNome" class="invalid-feedback">O nome precisa ser informado</label>  
			</div>
			
			<div class="mb-3 ">
					<label for="cnpj" class="form-labelb asterisk">CNPJ</label>
					<input id="cnpj" class="form-control" type='number' value="" />   
					<label id="feedCpf" class="invalid-feedback">O CNPJ precisa ser válido, não use pontos ou traços</label>  
			</div>

		</div>

		<div id="base_ENV" class="setecincoporcento">				
		</div>

	</body>

	<script>

		var _loadEnvCompleted = false;

		$(document).ready(function() {
			if (CheckLogin() == false)
				return;
			$("#menu").load("menu.html");
			$("#nome").attr('disabled', true);
			$("#cnpj").attr('disabled', true);
			$("#base_ENV").load("fornecedor_base_ENV.html", function (){
				_loadEnvCompleted = true;
				StartLoadData();
			});					 					
		});

		function CheckLogin(){
			var idusuario = getLoggedUserId();
			if (idusuario == -1)
			{
				var page =  window.location.pathname.split("/").pop();
				window.location.href = window.location.href.replace(page,'login.html');	
				return false;					
			}								
			else
			{
				$('#idusuario').val(idusuario);
				return true;
			}
		}

		function StartLoadData(){
			if (!_loadEnvCompleted)
				return;
			LoadData();
		}

		function LoadData(){
			var query = queryObj();
			WebApi_GET_Fornecedor
            (
				query.id, 
				function success(data) {			
					//console.log(data);	                                             
					$('#idfornecedor').val(data.id);		
					$('#nome').val(data.nome);
					$('#cnpj').val(data.cnpj);                       
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					//console.log(xhr.responseText);			
				}
            );
		}

		function EnviarClick()
		{	
			WebApi_DELETE_Fornecedor
			(
				$('#idfornecedor').val(),
				function success(data){
					//console.log(data);
				},
				function complete(xhr, text){
					console.log(xhr.status);
					//console.log(xhr.responseText);
					if (xhr.status == 204){
						$('#falha').css('display','none');
						$('#sucesso').css('display','block');
						$('#sucesso').html("O fornecedor foi excluido com sucesso! <a href='fornecedor_listar.html'>Seguir para a lista de fornecedores</a>");				
					}
					else{
						$('#sucesso').css('display','none');
						$('#falha').css('display','block');
						$('#falha').text("Ocorreu uma falha: " + xhr.responseText);
					}
				}
			);
		}

	</script>

</html>