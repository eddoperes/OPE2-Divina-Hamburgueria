<html>

	<head>
		<meta charset="utf8"/>
		<script src="jquery/jquery3.6.js"></script>
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" >
		<script src="bootstrap/dist/js/bootstrap.js"></script>
			<link rel="stylesheet" href="css/sistema.css" >
			<script src="js/sistema.js"></script>
	</head>

	<body>     

		<div class="setecincoporcento">

			<input type="hidden" id="idusuario" value="0">

			<br/>
			<a href="home.html">Home</a>		
			<br/>

			<br/>
			<h1>Listar pedidos delivery</h1>
			<br/>

			<a href="pedidodelivery_novo.html">Novo</a>
			<br/>
			<br/>

			<div class="borderumpixelpaddingvintepixel">
				<div class="mb-3">
					<label for="estado" class="form-label">Estado</label>
					<select id="estado" class="form-control">
						<option value="">Qualquer</option>
						<option value="1">Emitido</option>
						<option value="2">Cancelado</option>
						<option value="3">Embalado</option>
						<option value="4">Entregue</option>
					</select>
				</div>

				<div class="col-auto">
						<input type='button' class="btn btn-primary mb-3" value='Pesquisar' onclick="Busca()" />    
				</div>
			</div>

			<div id="table_container">
			</div>

		</div>

	</body>

	<script>

		$(function(){
			if (CheckLogin() == false)
				return; 				
		});	

		function CheckLogin(){
			var idusuario = getLoggedUserId();
			if (idusuario == -1)
			{
				var page =  window.location.pathname.split("/").pop();
				window.location.href = window.location.href.replace(page,'login.html');	
				return false;					
			}								
			else
			{
				return true;
			}
		}

		function Busca()
		{

			WebApi_GET_LIST_PedidoDelivery
			(
				'?estado=' + $('#estado').val(), 
				function success(data) {			
					console.log(data);			
					var textData = '<table class="table">';

					textData += '<tr>';

					textData += '<th>';
					textData += 'Id';
					textData += '</th>';

					textData += '<th>';
					textData += 'Observação';
					textData += '</th>';

					textData += '<th>';
					textData += 'Total';
					textData += '</th>';

					textData += '<th>';
					textData += 'Estado';
					textData += '</th>';

					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '<th>';
					textData += '';
					textData += '</th>';

					textData += '</tr>';

					var i;	                       
					for (i=0; i < data.length; i++){
						textData += '<tr>';

						textData += '<td>';
						textData += data[i].id;
						textData += '</td>';

						textData += '<td>';
						if (data[i].observacao == null)
							textData += '-- em branco --';
						else
							textData += data[i].observacao;
						textData += '</td>';

						textData += '<td>';
						textData += data[i].total;
						textData += '</td>';

						textData += '<td>';
						if (data[i].estado == 1)
							textData += 'Emitido';
						else if (data[i].estado == 2)
							textData += 'Cancelado';
						else if (data[i].estado == 3)
							textData += 'Embalado';
						else
							textData += 'Entregue';
						textData += '</td>';

						textData += '<td>';
						textData += '<a href="pedidodelivery_editar.html?id=' + data[i].id + '">Editar</a>';
						textData += '</td>';

						textData += '<td>';
						textData += '<a href="pedidodelivery_excluir.html?id=' + data[i].id + '">Excluir</a>';
						textData += '</td>';

						textData += '</tr>';
					}	
					textData += '</table>'
					$('#table_container').html(textData);	
				},
				function complete(xhr, text) {
					console.log(xhr.status);
					console.log(xhr.responseText);			
				}     
			);

		}

	</script>

</html>